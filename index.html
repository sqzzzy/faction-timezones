<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Faction Timezones Map</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
  <style>
    #mobile-list-view {
      display: none;
      padding: 16px;
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      max-width: 100vw;
      min-height: 100vh;
      box-sizing: border-box;
    }

    .mobile-row {
      padding: 12px 0;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-size: 18px;
    }

    .flag-icon {
      width: 24px;
      height: auto;
    }

    .mobile-time {
      color: #ffbe3d;
      font-weight: bold;
      font-family: 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div id="torn-time">Current Torn Time: <span id="utc-time">Loading...</span></div>

  <div id="faction-logo">
    <img src="Logo.png" alt="Faction Logo" />
  </div>

  <div id="map-wrapper">
    <div id="map-container">
      <canvas id="dayNightCanvas"></canvas>
    </div>
  </div>

  <div id="map-footer">Classicvirgin Time Zones</div>

  <div id="country-counter">
    <h3>Members by Country</h3>
    <ul id="country-list"></ul>
  </div>

  <!-- Mobile View -->
  <div id="mobile-list-view"></div>

  <script>
    const isMobile = (
      window.matchMedia("(pointer: coarse)").matches ||
      /Mobi|Android|iPhone|iPad|Tablet/i.test(navigator.userAgent) ||
      window.innerWidth <= 820
    );

    async function loadMarkersOrList() {
      const people = await fetch("people.json").then(res => res.json());

      if (isMobile) {
        console.log("Mobile view detected");
        document.getElementById("map-wrapper").style.display = "none";
        document.getElementById("country-counter").style.display = "none";
        const listContainer = document.getElementById("mobile-list-view");
        listContainer.style.display = "block";

        // Sort people by left position (furthest left to right)
        const sortedPeople = [...people].sort((a, b) => {
          const aLeft = parseFloat(a.left);
          const bLeft = parseFloat(b.left);
          return aLeft - bLeft;
        });

        sortedPeople.forEach(p => {
          const names = p.name.split("<br>");
          names.forEach(name => {
            const row = document.createElement("div");
            row.className = "mobile-row";
            row.innerHTML = `
              <div style="display: flex; align-items: center; gap: 10px;">
                <img src="flags/${p.flag}.png" alt="${p.flag}" class="flag-icon" />
                <strong>${name}</strong>
              </div>
              <span class="mobile-time" data-tz="${p.timezone}">Loading...</span>
            `;
            listContainer.appendChild(row);
          });
        });
      } else {
        console.log("Desktop view - map would load here.");
        // Add map setup logic here
      }
    }

    function updateUTCTime() {
      const now = new Date();
      const utc = now.toUTCString().split(" ")[4];
      document.getElementById("utc-time").textContent = utc + " UTC";
    }

    function updateMobileTimes() {
      document.querySelectorAll(".mobile-time").forEach(el => {
        const tz = el.dataset.tz;
        const time = new Intl.DateTimeFormat("en-GB", {
          timeZone: tz,
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        }).format(new Date());
        el.textContent = time;
      });
    }

    loadMarkersOrList();
    updateUTCTime();
    setInterval(updateUTCTime, 1000);
    setInterval(updateMobileTimes, 1000);
  </script>
</body>
</html>